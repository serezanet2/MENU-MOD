local player = game:GetService("Players").LocalPlayer
local TweenService = game:GetService("TweenService")
local HttpService = game:GetService("HttpService")

-- Конфигурация (замените на свои реальные URL)
local API_URL = "https://serezanet2.github.io/GitUnlock/Gitmoder/?check="
local MAIN_SCRIPT_URL = "https://raw.githubusercontent.com/serezanet2/serezanet2-GIT-SALLI/main/script.lua"
local PROFILE_LINK = "https://serezanet2.github.io/GitUnlock/"

-- Создание интерфейса
local gui = Instance.new("ScreenGui")
gui.Name = "AuthGUI"
gui.Parent = game:GetService("CoreGui")
gui.DisplayOrder = 999999999
gui.IgnoreGuiInset = true
gui.ResetOnSpawn = false

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 500, 0, 300)
mainFrame.Position = UDim2.new(0.5, -250, 0.5, -150)
mainFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
mainFrame.BorderSizePixel = 0
mainFrame.ClipsDescendants = true
mainFrame.Parent = gui

-- Градиентный фон
local gradient = Instance.new("UIGradient")
gradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Color3.fromRGB(40, 40, 40)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(80, 80, 80))
})
gradient.Rotation = 90
gradient.Parent = mainFrame

-- Элементы интерфейса
local elements = {
    menuText = {
        Type = "TextLabel",
        Props = {
            Size = UDim2.new(0, 120, 0, 20),
            Position = UDim2.new(1, -130, 0, 10),
            Text = "Gitmoder",
            TextColor3 = Color3.fromRGB(200, 200, 200),
            TextXAlignment = Enum.TextXAlignment.Right,
            BackgroundTransparency = 1,
            Font = Enum.Font.GothamBold,
            TextSize = 14
        }
    },
    -- [Остальные элементы интерфейса...]
}

-- Создаем элементы интерфейса
for name, config in pairs(elements) do
    local element = Instance.new(config.Type)
    for prop, value in pairs(config.Props) do
        element[prop] = value
    end
    element.Parent = mainFrame
    elements[name] = element
end

-- Улучшенная проверка ключа
local function validateKey(key)
    -- Локальная проверка формата
    if not key or #key < 10 then return false end
    
    -- Проверка кэша
    if _G.KeyCache and _G.KeyCache[key] ~= nil then
        return _G.KeyCache[key]
    end

    local success, result = pcall(function()
        if not HttpService:IsHttpGetEnabled() then
            error("HTTP-запросы отключены")
        end
        
        local response = HttpService:JSONDecode(HttpService:GetAsync(API_URL..key, true))
        return response.valid == true
    end)
    
    -- Кэшируем результат
    _G.KeyCache = _G.KeyCache or {}
    _G.KeyCache[key] = success and result or false
    
    return _G.KeyCache[key]
end

-- Загрузка основного скрипта
local function loadMainScript()
    local success, script = pcall(function()
        return HttpService:GetAsync(MAIN_SCRIPT_URL, true)
    end)
    
    if success then
        local loadSuccess, err = pcall(loadstring, script)
        if not loadSuccess then
            warn("Ошибка загрузки:", err)
            return false
        end
        return true
    else
        warn("Ошибка получения скрипта:", script)
        return false
    end
end

-- Обработчики кнопок
elements.submitBtn.MouseButton1Click:Connect(function()
    local key = string.gsub(elements.textBox.Text, "%s+", "")
    if validateKey(key) then
        elements.statusText.Text = "Успешная проверка..."
        if loadMainScript() then
            gui:Destroy() -- Закрываем интерфейс после успешной загрузки
        end
    else
        elements.statusText.Text = "Неверный ключ!"
        task.wait(1.5)
        elements.statusText.Text = ""
    end
end)

elements.copyBtn.MouseButton1Click:Connect(function()
    pcall(function()
        if game:GetService("ClipboardService") then
            game:GetService("ClipboardService"):Set(PROFILE_LINK)
        else
            setclipboard(PROFILE_LINK)
        end
        elements.copyBtn.Text = "Скопировано!"
        task.wait(1.5)
        elements.copyBtn.Text = "Скопировать GitUnlock"
    end)
end)

-- Анимация появления
tween(mainFrame, {Position = UDim2.new(0.5, -250, 0.5, -150)}, 1.2, Enum.EasingStyle.Bounce)
